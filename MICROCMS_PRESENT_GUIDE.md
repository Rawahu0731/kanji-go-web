# microCMSでのプレゼント配布設定ガイド

このガイドでは、microCMSを使ってプレゼントを配布する方法を説明します。

## 1. microCMSでAPIを作成

microCMSの管理画面で新しいAPIを作成します。

### API設定
- **API名**: `presents`（推奨）
- **エンドポイント**: `presents`
- **APIの型**: リスト形式

## 2. APIスキーマの設定

以下のフィールドを作成します：

### 必須フィールド

#### `title` (テキスト)
- **フィールドID**: `title`
- **表示名**: タイトル
- **種類**: テキストフィールド
- **説明**: プレゼントのタイトル（例：「ログインボーナス」）

#### `description` (テキストエリア)
- **フィールドID**: `description`
- **表示名**: 説明
- **種類**: テキストエリア
- **説明**: プレゼントの説明文

#### `rewards` (繰り返し)
- **フィールドID**: `rewards`
- **表示名**: 報酬リスト
- **種類**: 繰り返しフィールド
- **説明**: 配布する報酬のリスト

繰り返しフィールド内のサブフィールド：

##### `rewardType` (セレクト)
- **フィールドID**: `rewardType`
- **表示名**: 報酬タイプ
- **種類**: セレクトフィールド
- **選択肢**:
  - `coins` - コイン
  - `medals` - メダル
  - `xp` - 経験値
  - `tickets` - チケット
  - `character` - キャラクター
  - `card` - カード

##### `amount` (数値)
- **フィールドID**: `amount`
- **表示名**: 数量
- **種類**: 数値フィールド
- **説明**: コイン、メダル、XP、チケットの場合の数量

##### `ticketId` (テキスト)
- **フィールドID**: `ticketId`
- **表示名**: チケットID
- **種類**: テキストフィールド
- **説明**: チケットの場合のID（オプション）

##### `characterId` (テキスト)
- **フィールドID**: `characterId`
- **表示名**: キャラクターID
- **種類**: テキストフィールド
- **説明**: キャラクターの場合のID（オプション）

#### `startDate` (日時)
- **フィールドID**: `startDate`
- **表示名**: 配布開始日時
- **種類**: 日時フィールド
- **説明**: この日時以降にプレゼントが配布されます

#### `expiryDate` (日時) - オプション
- **フィールドID**: `expiryDate`
- **表示名**: 有効期限
- **種類**: 日時フィールド
- **説明**: この日時まで受け取り可能（空欄の場合は無期限）

## 3. プレゼント配布の作成例

### 例1: ログインボーナス（コイン配布）

```json
{
  "title": "🎁 ログインボーナス",
  "description": "毎日ログインしてくれてありがとう！",
  "rewards": [
    {
      "rewardType": "coins",
      "amount": 5000
    }
  ],
  "startDate": "2025-12-18T00:00:00.000Z",
  "expiryDate": "2025-12-25T23:59:59.000Z"
}
```

### 例2: イベント記念（複数報酬）

```json
{
  "title": "🎉 1周年記念プレゼント",
  "description": "1周年を記念して豪華報酬をプレゼント！",
  "rewards": [
    {
      "rewardType": "coins",
      "amount": 50000
    },
    {
      "rewardType": "medals",
      "amount": 100
    },
    {
      "rewardType": "xp",
      "amount": 10000
    }
  ],
  "startDate": "2025-12-18T00:00:00.000Z",
  "expiryDate": "2025-12-31T23:59:59.000Z"
}
```

### 例3: チケット配布

```json
{
  "title": "🎫 ガチャチケットプレゼント",
  "description": "特別ガチャチケットを3枚プレゼント！",
  "rewards": [
    {
      "rewardType": "tickets",
      "amount": 3,
      "ticketId": "gacha_premium"
    }
  ],
  "startDate": "2025-12-18T00:00:00.000Z"
}
```

## 4. 動作の仕組み

1. **自動同期**: アプリは1時間ごとに自動的にmicroCMSからプレゼント情報を取得します
2. **配布条件**:
   - `startDate`（配布開始日時）を過ぎている
   - `expiryDate`（有効期限）内である、または期限が設定されていない
3. **重複防止**: 同じプレゼントは一度だけ配布されます
4. **手動更新**: プレゼントボックス画面の「🔄 更新」ボタンで手動同期も可能

## 5. 環境変数の設定

`.env`ファイルに以下を設定してください：

```env
VITE_MICROCMS_SERVICE_ID=your-service-id
VITE_MICROCMS_API_KEY=your-api-key
```

## 6. トラブルシューティング

### プレゼントが表示されない場合

1. microCMSの`presents` APIが正しく作成されているか確認
2. `startDate`が現在時刻より前になっているか確認
3. `expiryDate`が現在時刻より後になっているか確認（設定している場合）
4. ブラウザのコンソールでエラーメッセージを確認
5. 「🔄 更新」ボタンで手動同期を試す

### よくある間違い

- フィールドIDが正確に一致していない（大文字小文字も区別されます）
- 報酬タイプのスペルミス（`coins`, `medals`, `xp`, `tickets`, `character`, `card`）
- 日時フォーマットが正しくない

## 7. ベストプラクティス

- **わかりやすいタイトル**: ユーザーが一目で内容を理解できるタイトルをつける
- **詳細な説明**: プレゼントの内容や受け取り条件を明確に記載
- **適切な有効期限**: イベント性のあるプレゼントには期限を設定
- **テスト配布**: 本番配布前に少額のテスト配布で動作確認

## 8. セキュリティ注意事項

- microCMSのAPIキーは絶対に公開しないこと
- `.env`ファイルは`.gitignore`に含める
- 本番環境では環境変数として安全に管理する
